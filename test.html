<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Orders Made Easy with Order App – Your Nearest Stores in just One Tap</title>
    <!-- Meta Description -->
    <meta name="description" content="Order App makes shopping easy by connecting you with nearby stores within 1 KM. Order groceries, clothes, food, accessories, laundry, and more—all with just one tap!">
    <!-- Open Graph Meta Tags for Facebook and Instagram -->
    <meta property="og:title" content="Orders Made Easy with Order App – Your Nearest Stores in just One Tap">
    <meta property="og:description" content="Order App makes shopping easy by connecting you with nearby stores within 1 KM. Order groceries, clothes, food, accessories, laundry, and more—all with just one tap!">
    <meta property="og:url" content="https://order-1ib.pages.dev">
    <meta property="og:image" content="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000075498.webp?v=1738901678">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Order App">
    <meta property="og:locale" content="en_US">


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- xxxxxxxxxxxxxxxxxxxxxx -->
<link rel="stylesheet" href="https://order-1ib.pages.dev/index.css">     
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"> 
<link href="https://fonts.googleapis.com/css2?family=Lilita+One&amp;display=swap" rel="stylesheet">       
</head>
    <body onload="getUserLocation()">

        <div class="header">
    <a href="https://order-1ib.pages.dev" style="margin-right: 10px;">
        <h1 style="margin: 0;">Order App</h1>
    </a>    
    <div class="replaceable-text" onclick="showLocationPopup()" style="margin-right: 10px; margin-top:5px; cursor: pointer;">
    Change Location
   </div>
   <div class="icon-container" onclick="showLocationPopup()" style="cursor: pointer; margin-top:5px;">
    <i class="fa-solid fa-rotate" style="color: #009500;"></i>
   </div>
       </div>
          <!-- Welcome Screen -->
<div id="welcome" class="visible">    
        <h1>
            <span>O</span><span>r</span><span>d</span><span>e</span><span>r</span>
            <span class="space"></span>
            <span>A</span><span>p</span><span>p</span>
        </h1>
      <!--  <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/welcome_image.png?v=1737684481" alt="Welcome Image"> -->
    </div>
    
<script>    document.addEventListener("DOMContentLoaded", function () {
    const welcomeScreen = document.getElementById("welcome");
    const footer = document.querySelector("footer");

    // Check last visit time from localStorage
    const lastVisit = localStorage.getItem("lastWelcomeTime");
    const now = Date.now();
    const fifteenMinutes = 15 * 60 * 1000; // 15 minutes in milliseconds

    if (!lastVisit || now - lastVisit > fifteenMinutes) {
        // Save current timestamp
        localStorage.setItem("lastWelcomeTime", now);

        // Hide footer visually but keep its space
        if (footer) {
            footer.style.visibility = "hidden";
            footer.style.opacity = "0";
            footer.style.transition = "opacity 0.5s ease-in-out";
        }

        // Ensure welcome screen stays centered (only fade it out)
        welcomeScreen.style.visibility = "visible";
        welcomeScreen.style.opacity = "1";
        welcomeScreen.style.transition = "opacity 0.5s ease-in-out";

        setTimeout(() => {
            welcomeScreen.style.opacity = "0"; // Fade out
            setTimeout(() => {
                welcomeScreen.style.visibility = "hidden"; // Hide after fade
            }, 500);

            // Fade-in footer smoothly
            if (footer) {
                footer.style.visibility = "visible";
                footer.style.opacity = "1";
            }
        }, 4000);
    } else {
        // Skip welcome screen if visited within 15 mins
        welcomeScreen.style.visibility = "hidden";
        welcomeScreen.style.opacity = "0";
        if (footer) {
            footer.style.visibility = "visible";
            footer.style.opacity = "1";
        }
    }
});   
</script>        
                  <!--  -->
       <div id="categories" class="item-grid" style="margin-top: 60px; margin-bottom: 50px;">
<!-- xxxxxxxxxxxxxxxxxxxx -->           
           
           
           
           

<div class="cardx" onclick="showItems('vegetables')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072235.webp?v=1738386080" alt="Vegetables">
        <p>Vegetables</p>
    </div>
    
<div class="cardx" onclick="showItems('fruits')">
       <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072237.webp?v=1738385978" alt="Fruits">
       <p>Fruits</p>
    </div>
    
<div class="cardx" onclick="showItems('meat')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072170.webp?v=1738385944" alt="Meat">
        <p>Meat & Chicken</p>
    </div>

<div class="cardx" onclick="showItems('cafeteria')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072168.webp?v=1738385898" alt="Cafeteria">
        <p>Cafeteria</p>
    </div>

<div class="cardx" onclick="showItems('restaurants')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072167.webp?v=1738386042" alt="Restaurants">
        <p>Restaurants</p>
    </div>

<div class="cardx" onclick="showItems('bakery')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072169.webp?v=1738385927" alt="Bakery">
        <p>Bakery & Spreads</p>
    </div>

<div class="cardx" onclick="showItems('oils')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072175.webp?v=1738385868" alt="Oils">
        <p>Oils & Season</p>
    </div>

<div class="cardx" onclick="showItems('seafood')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072243.webp?v=1738385970" alt="Seafood">
        <p>Seafood</p>
    </div>

<div class="cardx" onclick="showItems('spices')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072183.webp?v=1738386023" alt="Spices">
        <p>Spices</p>
    </div>

<div class="cardx" onclick="showItems('beverages')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072229.webp?v=1738385955" alt="Beverages">
        <p>Beverages</p>
    </div>

<div class="cardx" onclick="showItems('beauty')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072220.webp?v=1738385848" alt="Beauty">
        <p>Beauty</p>
    </div>

<div class="cardx" onclick="showItems('eggs')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072226.webp?v=1738385841" alt="Eggs">
        <p>Eggs & Dairy</p>
    </div>

<div class="cardx" onclick="showItems('ready to cook')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072181.webp?v=1738386054" alt="Ready to cook">
        <p>Ready to cook</p>
    </div>

<div class="cardx" onclick="showItems('snacks')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072182.webp?v=1738385890" alt="Snacks">
        <p>Snacks & Sweets</p>
    </div>

<div class="cardx" onclick="showItems('rice & grains')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072172.webp?v=1738385935" alt="Rice & Grains">
        <p>Rice & Grains</p>
    </div>

<div class="cardx" onclick="showItems('delicatessen')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072171.webp?v=1738386062" alt="Delicatessen">
        <p>Delicatessen</p>
    </div>

<div class="cardx" onclick="showItems('nuts')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072255.webp?v=1738386004" alt="Nuts">
        <p>Nuts</p>
    </div>

<div class="cardx" onclick="showItems('frozen')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072174.webp?v=1738386033" alt="Frozen">
        <p>Frozen & Can</p>
    </div>

<div class="cardx" onclick="showItems('tea')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072177.webp?v=1738385962" alt="Tea & coffee">
        <p>Tea & coffee</p>
    </div>

<div class="cardx" onclick="showItems('babies')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072254.webp?v=1738385879" alt="Babies">
        <p>Babies</p>
    </div>

<div class="cardx" onclick="showItems('personal')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072250.webp?v=1738385859" alt="Personal care">
        <p>Personal care</p>
</div>           
           
<div class="cardx" onclick="showItems('home')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000075595.webp?v=1739037778" alt="Home">
        <p>Home</p>
</div          
           
                                                       
           
<!-- xxxxxxxxxxxxxxxxxxxxxx -->           
       </div> 
                  <!--  -->    
    <div id="itemPopup" class="popup">        
 <div id="itemList"></div></div>                              
                   <!--  -->
<div id="locationPopup" class="popup2">  
    <div class="popup-footer">
        <span></span>
        <button onclick="closePopup()">
            <i class="fas fa-times"></i>
        </button>
    </div>      
    <div id="locationsList" class="popup-content"></div></div>
                   <!--  -->
<div id="cityPopup" class="popup2">  
    <div class="popup-footer">
        <button class="back-btn" onclick="goBackToLocations()">
       <i class="fas fa-arrow-left"></i> 
        </button>
        <button onclick="closePopup()">
       <i class="fas fa-times"></i>
        </button>
    </div>     
    <div id="cityList" class="popup-content"></div></div>
                   <!--  -->    
    <div id="errorPopup" class="popup2">
        <h3>Item Not Available</h3>
        <p>The selected item is not available nearby.</p>
        <br><br>
   <button onclick="closeErrorPopup()">OK</button>
    </div>


    <div id="errorPopup2" class="popup2">
        <h3>Item Not Available</h3>
        <p>Please Turn <b>ON<b> the location in your device</p>
        <br><br>
   <button onclick="closeErrorPopup()">OK</button>
        </div>

        
                   <!--  -->
    <div id="locationErrorPopup" class="popup2">
        <br>
        <h3>Error</h3>
        <p>Unable to get your current location. Please turn <b>ON</b> the location</p>
        <br><br>
    <button onclick="closePopup()">OK</button>
    </div>
                   <!--  -->
   <div id="locationPromptPopup" class="bottom-popup">
        <p>Please turn on your location services for a better experience.</p></div>
                   <!--  -->
     <div id="selectLocationPopup" class="bottom-popup" style="display: none;">
    <p>Please turn your location <b>ON</b><br><br>OR<br><br>if <b>ON</b> REFRESH the page</p>
</div>                   
           <!-- Edit Popup -->
<div id="editPopup">
    <h3>Change Saved Location?</h3>
    <div class="input-container">
        <input type="text" id="editNameInput" placeholder="Enter new name" maxlength="14">
    </div>
    <div class="popup-buttons">
        <button id="editNoButton" onclick="handleEditNo()">No</button>
        <button id="editYesButton" onclick="handleEditYes()">Yes</button>
    </div>
</div>
          <!-- customNamePopup  -->
<div id="saveLocationPopup">
    <h3>Your Favourite Location</h3>
    <div class="input-container">
        <input type="text" id="saveLocationInput" placeholder="Home / Office" maxlength="14">
    </div>
    <div class="popup-buttons">
        <button id="cancelButton" onclick="closeSaveLocationPopup()">Cancel</button>
        <button id="saveLocationConfirm">Save</button>
    </div>
</div>    
         <!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>
<!-- ///////////////////////// -->
<script src="https://order-1ib.pages.dev/categories.js"></script>
<script src="https://order-1ib.pages.dev/coordinates.js"></script>
<script src="https://order-1ib.pages.dev/page.js"></script>
<script>
    function getUserLocation() {
        let savedLocation = getSavedLocation();

        if (savedLocation) {
            updateReplaceableText(savedLocation);
        }

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    let userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        timestamp: Date.now(),
                        type: "device"
                    };
                    saveLocation(userLocation);
                    updateReplaceableText(userLocation);
                },
                () => {
                    if (!savedLocation) {
                        showLocationPopup();
                    }
                },
                { timeout: 10000 }
            );
        } else if (!savedLocation) {
            showLocationPopup();
        }
    }

    function saveLocation(location) {
        localStorage.setItem("userLocation", JSON.stringify(location));
    }

    function getSavedLocation() {
    let savedLocation = localStorage.getItem("userLocation");
    if (savedLocation) {
        savedLocation = JSON.parse(savedLocation);

        let expiryTime;
        if (savedLocation.type === "device") {
            expiryTime = 1200000; // 20 minutes
        } else if (savedLocation.type === "saved") {
            expiryTime = Infinity; // Never expires
        } else if (savedLocation.type === "city") {
            expiryTime = 3600000; // 1 hour
        }

        if (expiryTime !== Infinity && Date.now() - savedLocation.timestamp > expiryTime) {
            localStorage.removeItem("userLocation");
            return null;
        }
        return savedLocation;
    }
    return null;
}

//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

    function updateReplaceableText(location) {
        let replaceableText = document.querySelector(".replaceable-text");
        if (!location) return;

        if (location.type === "device") {
            let closestCity = null;
            let minDistance = Infinity;

            for (const region in locations) {
                for (const city in locations[region]) {
                    const cityCoords = locations[region][city];
                    const distance = getDistance(
                        location.lat, location.lng,
                        cityCoords.lat, cityCoords.lng
                    );
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestCity = city;
                    }
                }
            }

            replaceableText.innerText = closestCity && minDistance <= 50 ? closestCity : "Current Location";
        } else {
            replaceableText.innerText = location.name || "Saved Location";
        }
    }

//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

    function showLocationPopup() {
        let locationList = `<h4 class="current-location" onclick="useCurrentLocation()">Current Location</h4>`;

        const savedLocation = JSON.parse(localStorage.getItem("savedLocation"));
        if (savedLocation) {
            locationList += `<h4 class="current-location" onclick="useSavedLocation()">${savedLocation.name}</h4>`;
        } else {
            locationList += `<h4 class="current-location" onclick="saveDeviceLocation()">Save Location</h4>`;
        }

        for (const region in locations) {
            locationList += `<h4 onclick="openCityPopup('${region}')">${region}</h4>`;
        }
        document.getElementById("locationsList").innerHTML = locationList;
        document.getElementById("locationPopup").style.display = "block";
    }

//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx




function useCurrentLocation() {
    if (!navigator.geolocation) {
        showLocationErrorPopup(); // If geolocation is not supported, show error
        return;
    }

    let locationRetrieved = false;
    let countdown;  

    // Create timer and spinner UI
    const timerContainer = document.createElement('div');
    timerContainer.style.position = 'fixed';
    timerContainer.style.top = '50%';
    timerContainer.style.left = '50%';
    timerContainer.style.transform = 'translate(-50%, -50%)';
    timerContainer.style.fontSize = '12px';
    timerContainer.style.color = 'white';
    timerContainer.style.fontWeight = 'bold';
    timerContainer.style.zIndex = '9999';
    timerContainer.innerText = '30s'; // Initial countdown text

    const overlay = document.createElement('div');  
    overlay.className = 'loading-overlay';

    const spinner = document.createElement('div');
    spinner.className = 'loading-spinner';

    overlay.appendChild(spinner);
    document.body.appendChild(overlay);
    document.body.appendChild(timerContainer);

    let timeLeft = 30;

    function startCountdown() {
        countdown = setInterval(() => {  
            if (timeLeft > 0) {  
                timeLeft--;  
                timerContainer.innerText = `${timeLeft}s`;  
            } else {  
                clearInterval(countdown);
                if (!locationRetrieved) {
                    showErrorPopup2(); // Show timeout error if location is still not retrieved
                }
            }  
        }, 1000);
    }

    startCountdown(); // Always start animation first

    navigator.geolocation.getCurrentPosition(
        (position) => {
            locationRetrieved = true;
            clearInterval(countdown); // Stop the countdown on success
            removeLoadingUI();

            let userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                timestamp: Date.now(),
                type: "device"
            };
            saveLocation(userLocation);
            updateReplaceableText(userLocation);
            closePopup();
        },
        (error) => {
            clearInterval(countdown); // Stop countdown on failure
            removeLoadingUI();

            showLocationErrorPopup(); // Immediately show error popup
        },
        { timeout: 30000 }
    );

    function removeLoadingUI() {
        document.body.removeChild(overlay);
        document.body.removeChild(timerContainer);
    }

    function showLocationErrorPopup() {
        const errorPopup = document.getElementById("locationErrorPopup");
        if (errorPopup) {
            errorPopup.classList.add("popup2");
            errorPopup.style.display = "block";
        }
    }

    function showErrorPopup2() {
        const errorPopup2 = document.getElementById("errorPopup2");
        if (errorPopup2) {
            errorPopup2.classList.add("popup2");
            errorPopup2.style.display = "block";
        }
    }
    }

    




    
//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

    // Function to open the edit popup
    function openEditPopup() {
        const savedLocation = JSON.parse(localStorage.getItem("savedLocation"));
        if (!savedLocation) {
            alert("No saved location to edit.");
            return;
        }

  // Set the current name in the input field
        document.getElementById("editNameInput").value = savedLocation.name;

        // Display the edit popup
        document.getElementById("editPopup").style.display = "block";
    }

    // Function to handle the "Yes" button click
    function handleEditYes() {
        const savedLocation = JSON.parse(localStorage.getItem("savedLocation"));
        const newName = document.getElementById("editNameInput").value;

        if (newName) {
            // Update the name
            savedLocation.name = newName;

            // Retrieve new location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        savedLocation.lat = position.coords.latitude;
                        savedLocation.lng = position.coords.longitude;
                        savedLocation.timestamp = Date.now();

                        // Save the updated location
                        localStorage.setItem("savedLocation", JSON.stringify(savedLocation));
                        updateReplaceableText(savedLocation); // Refresh the UI
                        closeEditPopup();
                        showLocationPopup(); // Refresh the location popup
                    },
                    () => {
                        alert("Failed to retrieve new location. Name updated, but coordinates remain the same.");
                        localStorage.setItem("savedLocation", JSON.stringify(savedLocation));
                        closeEditPopup();
                        showLocationPopup();
                    }
                );
            } else {
                alert("Geolocation is not supported. Name updated, but coordinates remain the same.");
                localStorage.setItem("savedLocation", JSON.stringify(savedLocation));
                closeEditPopup();
                showLocationPopup();
            }
        } else {
            alert("Please enter a valid name.");
        }
    }

    // Function to handle the "No" button click
    function handleEditNo() {
        const savedLocation = JSON.parse(localStorage.getItem("savedLocation"));
        const newName = document.getElementById("editNameInput").value;

        if (newName) {
            // Update only the name
            savedLocation.name = newName;
            localStorage.setItem("savedLocation", JSON.stringify(savedLocation));
            updateReplaceableText(savedLocation); // Refresh the UI
        }

        closeEditPopup();
        showLocationPopup(); // Refresh the location popup
    }

    // Function to close the edit popup
    function closeEditPopup() {
        document.getElementById("editPopup").style.display = "none";
    }

    // Function to show the location popup with the edit button
    function showLocationPopup() {
        let locationList = `<h4 class="current-location" onclick="useCurrentLocation()">Current Location</h4>`;

        const savedLocation = JSON.parse(localStorage.getItem("savedLocation"));
        if (savedLocation) {
            // Add the saved location with an edit button
            locationList += `
                <h4 class="current-location" onclick="useSavedLocation()">
                    ${savedLocation.name}
                    <i class="fa-solid fa-rotate" style="color: #009500; cursor: pointer; margin-left: 10px;" onclick="event.stopPropagation(); openEditPopup()"></i>
                </h4>
            `;
        } else {
            locationList += `<h4 class="current-location" onclick="saveDeviceLocation()">Save Location</h4>`;
        }

        for (const region in locations) {
            locationList += `<h4 onclick="openCityPopup('${region}')">${region}</h4>`;
        }

        document.getElementById("locationsList").innerHTML = locationList;
        document.getElementById("locationPopup").style.display = "block";
    }

//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  
function saveDeviceLocation() {
    if (navigator.geolocation) {
        showLoadingAnimation(); // Show loading animation

        navigator.geolocation.getCurrentPosition(
            (position) => {
                setTimeout(() => {
                    hideLoadingAnimation(); // Hide loading animation
                    closeLocationPopup(); // Close locationPopup
                    openSaveLocationPopup(); // Open saveLocationPopup

                    document.getElementById("saveLocationConfirm").onclick = function () {
                        const customName = document.getElementById("saveLocationInput").value.trim();
                        if (customName) {
                            const savedLocation = {
                                name: customName,
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                type: "saved"
                            };
                            localStorage.setItem("savedLocation", JSON.stringify(savedLocation));
                            updateReplaceableText(savedLocation);
                            closeSaveLocationPopup();
                            setTimeout(() => location.reload(), 500);
                        } else {
                            alert("Please enter a name for this location.");
                        }
                    };
                }, 1000); // Delay to ensure UI updates smoothly
            },
            (error) => {
                hideLoadingAnimation(); // Hide loading animation on error
                showLocationError(error);
            }
        );
    } else {
        alert("Geolocation is not supported by your browser.");
    }
}

function showLoadingAnimation() {
    const loadingOverlay = document.getElementById("loadingOverlay");
    if (loadingOverlay) {
        loadingOverlay.style.display = "flex";
        console.log("Loading animation shown");
    } else {
        console.error("Error: Loading overlay not found!");
    }
}

function hideLoadingAnimation() {
    const loadingOverlay = document.getElementById("loadingOverlay");
    if (loadingOverlay) {
        setTimeout(() => {
            loadingOverlay.style.display = "none";
            console.log("Loading animation hidden");
        }, 500); // Small delay to prevent flickering
    }
}

function closeLocationPopup() {
    const locationPopup = document.getElementById("locationPopup");
    if (locationPopup) locationPopup.style.display = "none";
}

function openSaveLocationPopup() {
    const saveLocationPopup = document.getElementById("saveLocationPopup");
    if (saveLocationPopup) saveLocationPopup.style.display = "block";
}

function closeSaveLocationPopup() {
    const saveLocationPopup = document.getElementById("saveLocationPopup");
    if (saveLocationPopup) saveLocationPopup.style.display = "none";
}

//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
          
    function useSavedLocation() {
        const savedLocation = JSON.parse(localStorage.getItem("savedLocation"));
        if (savedLocation) {
            updateReplaceableText(savedLocation);
            saveLocation(savedLocation); // Set as the current active location
            closePopup();
        }
    }

//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   
    function searchItem(item) {
        let userLocation = getSavedLocation();

        if (!userLocation) {
            const locationPopup = document.getElementById("selectLocationPopup");
            locationPopup.style.display = "block";
            setTimeout(() => {
                locationPopup.style.display = "none";
            }, 4000);
            return;
        }

        let nearbyVendors = [];
        for (const vendor in vendors) {
            let distance = getDistance(
                userLocation.lat, userLocation.lng,
                vendors[vendor].lat, vendors[vendor].lng
            );
            if (distance <= 1) nearbyVendors.push(`vendor:${vendor}`);
        }

        if (nearbyVendors.length > 0) {
            window.location.href = `https://order-app-ae.myshopify.com/search?q=${encodeURIComponent(item)}+${nearbyVendors.join(" OR ")}`;
        } else {
            document.getElementById("errorPopup").style.display = "block";
        }
    }

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    // Initialize on page load
    getUserLocation();
    
    //FOOTER
document.addEventListener("DOMContentLoaded", function () {
    document.querySelector('.home-btn').addEventListener('click', function() {
        document.querySelectorAll('.popup, .popup2').forEach(popup => {
            if (popup.style.display !== 'none') {
                popup.style.display = 'none';
            }
        });
    });
});        
</script>
<script>
    //when the back button is pressed
window.addEventListener('popstate', function (e) {
    const popup = document.getElementById("itemPopup");

    // Check if the popup is open
    if (popup.style.display === "block") {
        // Close the popup
        popup.style.display = "none";
        
        // Prevent the default behavior of going back
        history.pushState(null, null, location.href);
    }
});

// Function to open the popup and update the browser history state
function showItems(category) {
    fetch(categoryUrls[category])
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.text();
        })
        .then(data => {
            let parser = new DOMParser();
            let doc = parser.parseFromString(data, "text/html");
            let items = [];

            doc.querySelectorAll(".item-card").forEach(card => {
                let img = card.querySelector("img")?.src;
                let name = card.querySelector("p")?.textContent;
                if (img && name) items.push({ name, image: img });
            });

            let itemList = `<div class="item-grid">`;
            items.forEach(item => {
                itemList += `
                    <div class="item-card" onclick="searchItem('${item.name}')">
                        <img src="${item.image}" alt="${item.name}" loading="lazy">
                        <p>${item.name}</p>
                    </div>
                `;
            });
            itemList += `</div>`;
            document.getElementById("itemList").innerHTML = itemList;
            document.getElementById("itemPopup").style.display = "block";

            // Push state to the history to avoid going back to previous page
            history.pushState(null, null, location.href);
        })
        .catch(error => {
            console.error("Error loading items:", error);
            document.getElementById("errorPopup").style.display = "block";
        });
}
</script>
<!-- ///////////////////////// -->    
         <!-- FOOTER -->
<footer class="footer">  
    <a href="https://order-app-ae.myshopify.com/cart" class="footer-btn">
        <i class="fas fa-shopping-cart"></i>
    </a>
    <button class="footer-btn home-btn">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000074587.webp?v=1738560869" alt="Home" style="width: 80px; height: auto; margin-bottom: 0px; margin-left: -7px;">
    </button>            
    <a href="https://shopify.com/66437513414/account" class="footer-btn">
        <i class="fas fa-user"></i>
    </a>
</footer>
