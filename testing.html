<body>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Righteous&amp;display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;    
    min-height: 100vh;
    color: #000;
    position: relative;
  }
  
    .input-container {
      margin-top:40px;
      padding: 20px;
      background: #f0f0f0;
      display: flex;
      gap: 10px;
    }
    .input-container input {
      padding: 10px;
      font-size: 16px;
      flex: 1;
    }
    .input-container button {
      padding: 10px 20px;
      font-size: 16px;
      background: #009500;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    .main-content {
      padding: 20px; 
      display: none;
    }      
  
  header {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 50px;
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  header img {
    width: 150px; height: auto; display: block;
  }
       
  .main-content {
    position: relative;
    z-index: 1;
    max-width: 100vw;
    margin: 60px 10px 60px 10px;
    border-radius: 20px;
    padding: 18px 5vw 18px 5vw;
    box-shadow: 0 8px 32px rgba(0,0,0,1);
    background: hsla(0, 0%, 100%, 0.7);
    backdrop-filter: blur(10px);
  }
  
  .cover-container {
  width: 100%;
  height: 160px;
  overflow: hidden;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
}

.cover-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.restaurant-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-top: -50px;
  padding-left: 20px;
}

.restaurant-banner {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-top: -40px;
  padding: 0 20px;
  position: relative;
  z-index: 10;
  border-radius: 0;
  background: none;
  backdrop-filter: none;
  box-shadow: none;
}

.restaurant-banner .logo {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #009500;
  background: none;
  box-shadow: none;
  margin-top: -100px;
}

.restaurant-info {
  flex: 1;
  margin-top: 50px;
}

.restaurant-title {
  font-family: 'Righteous', cursive;
  font-size: 2rem;
  color: yellow;
  -webkit-text-stroke: 1px black;
  margin: 0 0 6px 0;
}

.email {
  font-size: 1.1rem;
  margin: 2px 0;
  color: #444;
}

.address,
.contact {
  font-size: 1rem;
  font-weight: bold;
  margin: 2px 0;
  color: #222;
}

  h2 {
    text-align: center;
    color: #009500;
    font-size: 2rem;
    margin-bottom: 18px;
    letter-spacing: 1px;
  }
  .category-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 28px;
  }
  .category-buttons button {
    border-radius: 50px;
    padding: 12px 24px;
    border: none;
    background: #009500;
    color: #fff;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.2s, transform 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  .category-buttons button:hover, .category-buttons button:focus {
    background: #000;
    color: #fff;
    transform: translateY(-2px) scale(1.05);
  }
  .product-card {
    border: 1px solid #e0e0e0;
    border-radius: 16px;
    margin-bottom: 18px;
    padding: 14px;
    display: flex;
    gap: 16px;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,149,0,0.05);
    align-items: center;
  }
  .product-card img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid #00950022;
    background: #f8f8f8;
  }
  .product-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 7px;
  }
  .product-info strong {
    color: #009500;
    font-size: 1.08rem;
    margin-bottom: 2px;
  }
  select, input[type="number"] {
    padding: 7px;
    border-radius: 6px;
    border: 1px solid #ddd;
    margin-top: 2px;
    font-size: 1rem;
    outline: none;
    width: 100%;
    background: #f6f6f6;
  }
  button.add-btn {
    background: #009500;
    color: #fff;
    padding: 7px 0;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    margin-top: 4px;
    cursor: pointer;
    transition: background 0.2s;
  }
  button.add-btn:hover, button.add-btn:focus {
    background: #000;
  }
  .cart-section {
    margin-top: 36px;
    background: #f8fff8;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0,149,0,0.05);
    border: 2px solid #009500;
    padding: 20px 18px 18px 18px;
  }
  .cart-section h3 {
    color: #009500;
    margin-bottom: 14px;
    font-size: 1.18rem;
  }
  .cart-item {
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid #e0e0e0;
    padding: 7px 0;
    font-size: 1rem;
  }
  #cart-items {
    min-height: 30px;
    margin-bottom: 8px;
  }
  .cart-item button:hover svg path {
  stroke: #000;
  }

  .order-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 8px;
  }
  input#table-number {
    padding: 5px 8px;
    border-radius: 6px;
    border: 1px solid #aaa;
    width: 90px;
    font-size: 1.05rem;
    background: #fff;
    text-align: center;
    margin: 0;
  }
  button.order-btn {
    background: #009500;
    color: #fff;
    padding: 10px 0;
    border: none;
    border-radius: 8px;
    width: 100%;
    max-width: 220px;
    font-size: 1.13rem;
    font-weight: 700;
    letter-spacing: 1px;
    cursor: pointer;
    transition: background 0.2s;
  }
  button.order-btn:hover, button.order-btn:focus {
    background: #000;
  }
.footer {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100vw;
  background: rgba(0,0,0,0.9);
  color: #fff;
  text-align: center;
  z-index: 1000;
  letter-spacing: 1px;
  box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
  font-size: 1rem;
  line-height: 1.2;
}
  .footer b {
    color: #009500;
    font-family: 'Righteous', cursive;
    font-style: italic;
    font-size: 1.5em;
  }
@media (max-width: 700px) {
  .main-content {
    max-width: 100vw;
    margin: 60px 10px 10px 10px;
    border-radius: 20px;
    padding: 18px 5vw 18px 5vw;
  }
  .logo { width: 150px; height: 150px;}
  .product-card img { width: 65px; height: 65px; }
  header { height: 44px; }
  .footer { font-size: 0.8rem; }
  .order-row { flex-direction: column; align-items: stretch; gap: 8px; }
  input#table-number, button.order-btn { width: 100%; max-width: none; }
  .category-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 20px 0;
  padding: 0 10px; }
.category-buttons button {
  width: 100%;
  font-size: 1rem;
  padding: 12px; }
}

.success-popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border: 2px solid #009500;
  border-radius: 20px;
  padding: 20px 30px;
  z-index: 2000;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  text-align: center;
  font-size: 1.1rem;
  max-width: 80%;
  color: #000;
}

#ad-popup {
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 600px;
  pointer-events: auto;
  z-index: 9999;
}

.ad-popup {
  position: relative;
  width: 100%;
  height: auto;
  background: #000;
  overflow: hidden;
  border-radius: 8px;
}

.ad-popup video {
  width: 100%;
  height: auto;
  display: block;
}

.ad-buttons {
  position: absolute;
  bottom: 10px;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 15px;
  box-sizing: border-box;
}

.go-site, .skip-ad {
  background-color: #009500;
  border: none;
  padding: 8px 14px;
  font-weight: bold;
  color: #000;
  border-radius: 4px;
  cursor: pointer;
  text-decoration: none;
}

.skip-ad {
  background-color: rgba(0,0,0,0.6);
  color: #fff;
}

#orders-content {
  max-width: 600px;
  margin: 10px 5px 100px 5px;
  padding: 1rem;
  font-family: Arial, sans-serif;
  background-color: #fafafa;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
}

#orders-content h2 {
  text-align: center;
  margin-bottom: 1rem;
  font-size: 1.5rem;
  color: #009500;
}

.order-entry {
  border: 3px solid #ccc;
  background: #fff;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.order-entry p {
  margin: 0.25rem 0;
  font-size: 0.95rem;
  color: #444;
}

.order-entry ul {
  list-style-type: disc;
  padding-left: 1.5rem;
  margin: 0.5rem 0;
}

.order-entry li {
  font-size: 0.9rem;
  color: #555;
}

.order-entry strong {
  color: #000;
}

@media (max-width: 480px) {
  #orders-content {
    padding: 0.75rem;
  }

  .order-entry {
    padding: 0.75rem;
  }

  #orders-content h2 {
    font-size: 1.25rem;
  }
}
</style>
<style>
    #editModal {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      max-width: 600px;
      background: #e6f5e6;
      border-radius: 10px;
      outline: 1px solid #009500;
      
      padding:20px;
      padding-bottom:0;
      z-index: 9999;
    }
    #editModal input[type="text"],
    #editModal input[type="email"] {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      margin: 2px auto;
      border-radius: 5px;
      border: 1px solid #ccc;
      display: block;
    }
    #editModal .modal-footer {
      text-align: right;
    }
    #editModal button {
      background-color: #009500;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #editBtn {
      background-color: #000;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      display: block;
      margin-left: 120px;
    }

    #imageUploadForm input[type="file"] {
      display: none;
    }
    #imageUploadForm button.upload-btn {
      background-color: #000;
      color: white;
      padding: 5px 5px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>

<header>
  <a href="https://nearbys.online" style="display: inline-block; text-decoration: none;">
    <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/nearbys-logo.webp?v=1741164503" alt="Order App Logo">
  </a>
</header>

  <div class="input-container">
  <input type="text" id="userIdInput" placeholder="Enter USER ID">
  <button onclick="loadBusiness()">Go</button>
  </div>

  <div class="main-content" id="mainContent">
  <form id="imageUploadForm" enctype="multipart/form-data" novalidate style="text-align:right; margin-bottom:0px;">
      <input type="file" name="cover" accept="image/*" id="coverInput">
      <button type="button" class="upload-btn" data-input="coverInput">modify</button>    
  </form>  
  <div class="cover-container">
    <img id="coverImage" class="cover-image" src="" alt="Cover">
  </div>
        
  <div class="restaurant-banner">
  <div> 
   <img id="profileImage" class="logo" src="" alt="Logo">
   <form style="margin-left:50px; margin-top:-10px;" id="imageUploadForm" enctype="multipart/form-data" novalidate>
      <input type="file" name="profile" accept="image/*" id="profileInput">
      <button type="button" class="upload-btn" data-input="profileInput">modify</button>
   </form>
  </div>
  
  <div class="restaurant-info">
    <h1 class="restaurant-title" id="businessName"></h1>
  <p class="address" id="businessAddress"></p>
  <p class="email" id="businessEmail"></p>
  <p class="contact" id="businessContact"></p>
  <button id="editBtn">Edit</button>
  </div>
  </div>

<p style="font-weight:bold;">Background image</p>
<img id="backgroundImage" style="width:200px; height:auto;" src="" alt="Logo">
  <form style="margin-left:100px;" id="imageUploadForm" enctype="multipart/form-data" novalidate>    
      <input type="file" name="background" accept="image/*" id="backgroundInput">
      <button type="button" class="upload-btn" data-input="backgroundInput">modify</button>
  </form>      

  <h2 style="margin-top: 20px;">Menu</h2>
  <div class="category-buttons">
    <button onclick="loadProducts('starter-R1')">Starters</button>
    <button onclick="loadProducts('breakfast-R1')">Breakfast</button>
    <button onclick="loadProducts('lunch-R1')">Lunch</button>
    <button onclick="loadProducts('dinner-R1')">Dinner</button>
    <button onclick="loadProducts('juice-R1')">Juice</button>
    <button onclick="loadProducts('dessert-R1')">Desserts</button>
  </div>
  
  <div id="product-list"></div>
  <div class="cart-section">
    <h3>Your Order</h3>
    <div id="cart-items"></div>
    <div class="order-row">
      <input type="number" id="table-number" placeholder="Table #" min="1" required>
      <button class="order-btn" onclick="submitOrder()">Place Order</button>
    </div>
  </div>

<div id="empty-popup" class="success-popup" style="color:#fff; background: #000;">Cart is empty. Please add items.</div>
<div id="success-popup" class="success-popup">
  Order sent successfully!
</div>
<div id="error-popup" class="success-popup" style="color:#fff; background: #000;">
  Please enter your table number.
</div>
<div id="overlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:1999;"></div>

<div id="ad-popup" style="display: none;">
  <div class="ad-popup">
    <video src="https://cdn.shopify.com/videos/c/o/v/70c7fabadb774c0ca9ff51957f54dfb0.mp4" autoplay muted playsinline></video>
    <div class="ad-buttons">
      <a href="https://nearbys.online" class="go-site">Go to Site</a>
      <button class="skip-ad">Skip &gt;&gt;</button>
    </div>
  </div>
</div>

<div id="orders-content">
  <h2 style="color:#009500;font-weight:bold;">Active Orders</h2>
  <div id="orders-list"></div>
  <button id="toggle-delivered" 
        style="position: relative; float: right; margin: 10px 0; background-color: #000; color: #fff; border: none; padding: 8px 14px; border-radius: 5px; cursor: pointer;">
  Previous Orders
</button>
  <div id="delivered-orders" style="display:none;"></div>
</div> 



  <!-- Modal -->
  <div id="editModal">
    <span id="closeModal" style="position:absolute; top:-5px; right:10px; font-size:40px; font-weight:bold; cursor:pointer;">&times;</span>   
    <form id="modalForm" style="margin-top:20px;">
      <input type="text" name="name" placeholder="Business Name">
      <input type="text" name="address" placeholder="Address">
      <input type="email" name="email" placeholder="Email">
      <input type="text" name="contact" placeholder="Contact Number">
      <div class="modal-footer">
        <button style="margin-top:10px;" type="submit" id="modalSubmit">Submit</button>
      </div>
    </form>
  </div>
               
<script>
  const restaurantName = "Miamix";
let cart = [];

// Load products by tag and render cards
async function loadProducts(tag) {
  const productList = document.getElementById('product-list');
  productList.innerHTML = `<div style="text-align:center;color:#009500;font-weight:600;padding:30px 0;">Loading...</div>`;

  const res = await fetch(`/search?q=tag:${tag}&view=json`);
  const html = await res.text();
  const doc = new DOMParser().parseFromString(html, 'text/html');
  const products = [...doc.querySelectorAll('.product-item')];

  const productCards = await Promise.all(products.map(async productEl => {
    const handle = productEl.getAttribute('data-handle');
    const prodData = await fetch(`/products/${handle}.js`).then(res => res.json());

    const variantOptions = prodData.variants.map(v =>
      `<option value="${v.id}" data-price="${v.price / 100}">
        ${v.title} - $${(v.price / 100).toFixed(2)}
      </option>`).join('');

    return `
      <div class="product-card">
        <img src="${prodData.images[0] || 'https://cdn-icons-png.flaticon.com/512/3075/3075977.png'}" />
        <div class="product-info">
          <strong>${prodData.title}</strong>
          <select class="variant-select">${variantOptions}</select>
          <input type="number" class="qty-input" min="1" value="1">
          <button class="add-btn" onclick='addToCart(${JSON.stringify(prodData)}, this)'>Add</button>
        </div>
      </div>
    `;
  }));

  productList.innerHTML = productCards.join('');
}

// Add product to cart
function addToCart(product, btn) {
  const container = btn.closest('.product-info');
  const select = container.querySelector('.variant-select');
  const variantText = select.options[select.selectedIndex].text;
  const price = parseFloat(select.options[select.selectedIndex].dataset.price);
  const qty = parseInt(container.querySelector('.qty-input').value);
  const image = product.images[0] || '';

  cart.push({
    name: product.title,
    variant: variantText,
    price,
    quantity: qty,
    total: price * qty,
    image
  });

  renderCart();
}

// Render cart contents
function renderCart() {
  const cartItems = document.getElementById("cart-items");
  if (cart.length === 0) {
    cartItems.innerHTML = `<span style="color:#888;">No items yet.</span>`;
    // Remove total if cart is empty
    document.getElementById("cart-total")?.remove();
    return;
  }

  // Cart items with bin icon (SVG)
  cartItems.innerHTML = cart.map((item, idx) => `
    <div class="cart-item">
      <span>${item.name} (${item.variant}) x ${item.quantity}</span>
      <span>
        $${(item.total).toFixed(2)}
        <button onclick="removeCartItem(${idx})" style="margin-left:10px;color:#d32f2f;background:none;border:none;cursor:pointer;font-size:1.2em;" title="Remove">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="vertical-align:middle;">
            <path d="M6 6L14 14M14 6L6 14" stroke="#d32f2f" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </span>
    </div>
  `).join('');

  // Total
  let total = cart.reduce((sum, item) => sum + item.total, 0);
  if (!document.getElementById("cart-total")) {
    let totalDiv = document.createElement("div");
    totalDiv.id = "cart-total";
    totalDiv.style = "text-align:right;font-weight:bold;margin-top:10px;color:#009500;";
    totalDiv.innerHTML = `Total: $${total.toFixed(2)}`;
    document.getElementById("cart-items").appendChild(totalDiv);
  } else {
    document.getElementById("cart-total").innerHTML = `Total: $${total.toFixed(2)}`;
  }
}

function removeCartItem(index) {
  cart.splice(index, 1);
  renderCart();
}


  // Submit the order (backend integrated)
  async function submitOrder() {
    const tableNumber = document.getElementById('table-number').value.trim();
    if (!tableNumber) return showPopup('error-popup');
    if (cart.length === 0) return showPopup('empty-popup');

    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const random = Math.floor(100 + Math.random() * 900);
    const orderNumber = `MI${day}${month}${random}`;
    const total = cart.reduce((sum, item) => sum + item.total, 0);

    const newOrder = {
      date: now.toLocaleDateString(),
      time: now.toLocaleTimeString(),
      table: tableNumber,
      orderNumber,
      cart,
      total: total.toFixed(2),
      status: "Ordered",
      target: "https://nearbysx.pages.dev/miamix" // Frontend B
    };

    // Send to Glitch backend
await fetch("https://citrine-flint-sea.glitch.me/order", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(newOrder)
});

    // Save to localStorage
    const orders = JSON.parse(localStorage.getItem("restaurantOrders") || "[]");
    orders.unshift(newOrder);
    localStorage.setItem("restaurantOrders", JSON.stringify(orders));

    // Reset UI
    cart = [];
    renderCart();
    document.getElementById('table-number').value = '';
    displayOrders();
    showPopup('success-popup', () => {
      document.getElementById('ad-popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    });
  }

function displayOrders() {
  const orders = JSON.parse(localStorage.getItem("restaurantOrders") || "[]");

  const activeContainer = document.getElementById("orders-list");
  const deliveredContainer = document.getElementById("delivered-orders");
  activeContainer.innerHTML = "";
  deliveredContainer.innerHTML = "";

  if (orders.length === 0) {
    activeContainer.innerHTML = "<p>No orders yet.</p>";
    return;
  }

  orders.forEach(order => {
    const div = document.createElement("div");
    div.className = "order-entry";
    div.style.border = order.status !== "Delivered" ? "2px solid #009500" : "1px solid #ccc";
    div.style.marginBottom = "10px";
    div.style.padding = "10px";
    div.style.borderRadius = "6px";

     div.innerHTML = `
  <div style="display: flex; justify-content: space-between;">
  <div style="line-height: 0.7;">
  <p><strong>Date:</strong> ${order.date}</p>
    <p><strong>Time:</strong> ${order.time}</p>
  </div>
  </div>
  <hr>
  <div style="display: flex; justify-content: space-between;">
    <p><strong>Table:</strong> ${order.table}</p>
    <p><strong>Order #:</strong> ${order.orderNumber}</p>
  </div>
  <ul>
    ${order.cart.map(item => `<li>${item.name} x ${item.quantity} - $${(item.price * item.quantity).toFixed(2)}</li>`).join("")}
  </ul>
  <p style="text-align:right;"><strong>Total:</strong> $${order.total}</p>
  <hr>
  <p style="text-align:right; font-weight:bold; color:#550A35;">${order.status}  </p>
`;

    if (order.status === "Delivered") {
      deliveredContainer.appendChild(div);
    } else {
      activeContainer.appendChild(div);
    }
  });
}

document.getElementById("toggle-delivered").addEventListener("click", function () {
  const section = document.getElementById("delivered-orders");
  if (section.style.display === "none") {
    section.style.display = "block";
    this.textContent = "Hide Delivered Orders";
  } else {
    section.style.display = "none";
    this.textContent = "Show Delivered Orders";
  }
});

async function syncOrdersWithBackend() {
  const res = await fetch("https://citrine-flint-sea.glitch.me/orders");
  const backendOrders = await res.json();
  const localOrders = JSON.parse(localStorage.getItem("restaurantOrders") || "[]");

  const updatedOrders = localOrders.map(local => {
    const matched = backendOrders.find(o => o.orderNumber === local.orderNumber);
    return matched ? { ...local, status: matched.status } : local;
  });

  localStorage.setItem("restaurantOrders", JSON.stringify(updatedOrders));
  displayOrders();
}

// Poll every 1 minute
setInterval(syncOrdersWithBackend, 60000);
syncOrdersWithBackend(); // Initial run  
  
// Call this once on page load to show stored orders
document.addEventListener("DOMContentLoaded", displayOrders);

// Modified showPopup to accept an optional callback
function showPopup(id, callback) {
  const popup = document.getElementById(id);
  const overlay = document.getElementById('overlay');
  popup.style.display = 'block';
  overlay.style.display = 'block';
  setTimeout(() => {
    popup.style.display = 'none';
    overlay.style.display = 'none';
    if (typeof callback === 'function') callback();
  }, 2000);
}

function closeAd() {
  document.getElementById('ad-popup').style.display = 'none';
  document.getElementById('overlay').style.display = 'none';
}

document.addEventListener('DOMContentLoaded', function() {

  // Skip button
  document.querySelector('.skip-ad').addEventListener('click', closeAd);

  // Go to Site button - opens link in new tab
  document.querySelector('.go-site').addEventListener('click', function(e) {
    e.preventDefault(); // Prevent default anchor behavior
    closeAd();
    window.open(this.href, '_blank'); // Open link in new tab
  });
});

  async function checkOrderStatusUpdates() {
  const res = await fetch("https://citrine-flint-sea.glitch.me/orders");
  const allOrders = await res.json();
  const localOrders = JSON.parse(localStorage.getItem("restaurantOrders") || "[]");

  // Update matching orders
  const updatedOrders = localOrders.map(local => {
    const remote = allOrders.find(o => o.orderNumber === local.orderNumber);
    return remote ? { ...local, status: remote.status } : local;
  });

  localStorage.setItem("restaurantOrders", JSON.stringify(updatedOrders));
  displayOrders(); // re-render
}

setInterval(checkOrderStatusUpdates, 60000); // every minute
checkOrderStatusUpdates(); // initial run
</script>
<script>
  async function loadBusiness(optionalId = null) {
    const inputElement = document.getElementById('userIdInput');
    const userId = optionalId || inputElement.value.trim();

    if (!userId || isNaN(userId)) return alert('Please enter a valid numeric USER ID');

    const buttonElement = inputElement.nextElementSibling;
    buttonElement.textContent = 'Loading...';
    buttonElement.disabled = true;

    const url = `https://enormous-cream-transport.glitch.me/businesses/${userId}.json`;

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Business not found');
      const data = await res.json();

      // Save userId to localStorage
      localStorage.setItem('userId', userId);
      inputElement.value = userId;

      // Set background image
      document.body.style.background = `url(${data.backgroundUrl}) center/cover no-repeat fixed`;

      // Set images and business details
document.getElementById('coverImage').src = data.coverUrl;
      document.getElementById('profileImage').src = data.profileUrl;
      
document.getElementById('backgroundImage').src = data.backgroundUrl;      
      document.getElementById('businessName').textContent = data.name;
      document.getElementById('businessAddress').textContent = data.address;
      document.getElementById('businessEmail').textContent = data.email;
      document.getElementById('businessContact').textContent = `Contact: ${data.contact}`;

      // Show the content section
      document.getElementById('mainContent').style.display = 'block';
    } catch (err) {
      alert('Failed to load business info. Make sure the USER ID is correct.');
      console.error(err);
    } finally {
      buttonElement.textContent = 'Go';
      buttonElement.disabled = false;
    }
  }

  // Auto-load from localStorage
  window.addEventListener('DOMContentLoaded', () => {
    const savedId = localStorage.getItem('userId');
    if (savedId) {
      document.getElementById('userIdInput').value = savedId;
      loadBusiness(savedId);
    }
  });
</script>
<script>
  // Open modal
  document.getElementById('editBtn').addEventListener('click', () => {
    document.getElementById('editModal').style.display = 'block';
  });

  // Close modal
  document.getElementById('closeModal').addEventListener('click', () => {
    document.getElementById('editModal').style.display = 'none';
  });

  function getUserId() {
    return document.getElementById('userIdInput')?.value.trim() || '';
  }

  // Modal form submission
  document.getElementById('modalForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const submitBtn = document.getElementById('modalSubmit');
    submitBtn.textContent = 'Submitting...';

    const userId = getUserId();
    if (!userId) {
      alert('User ID is required.');
      submitBtn.textContent = 'Submit';
      return;
    }

    const form = e.target;
    const formData = new FormData();
    formData.append('businessId', userId);

    ['name', 'address', 'email', 'contact'].forEach(field => {
      const value = form[field].value.trim();
      if (value) formData.append(field, value);
    });

    try {
      const response = await fetch('https://enormous-cream-transport.glitch.me/upload-images', {
        method: 'POST',
        body: formData
      });

      const data = await response.json();

      if (!response.ok) {
        alert('Upload failed: ' + (data.error || 'Unknown error'));
        submitBtn.textContent = 'Submit';
        return;
      }

      location.reload(); // Refresh on success
    } catch (err) {
      alert('Upload error: ' + err.message);
      submitBtn.textContent = 'Submit';
    }
  });

  // Image upload auto-submit
  document.querySelectorAll('#imageUploadForm .upload-btn').forEach(button => {
    const inputId = button.dataset.input;
    const fileInput = document.getElementById(inputId);

    button.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', async () => {
      if (fileInput.files.length === 0) return;

      const userId = getUserId();
      if (!userId) {
        alert('User ID is required for image upload.');
        fileInput.value = '';
        return;
      }

      const formData = new FormData();
      formData.append('businessId', userId);
      formData.append(fileInput.name, fileInput.files[0]);

      const originalText = button.textContent;
      button.textContent = 'Modifying';
      button.disabled = true;

      try {
        const response = await fetch('https://enormous-cream-transport.glitch.me/upload-images', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (!response.ok) {
          alert('Image upload failed: ' + (data.error || 'Unknown error'));
        } else {
          location.reload(); // Refresh after successful upload
        }
      } catch (err) {
        alert('Upload error: ' + err.message);
      }

      button.textContent = originalText;
      button.disabled = false;
      fileInput.value = '';
    });
  });
</script>

</div>
<footer class="footer">
  <div style="padding: 10px;">
    <b>nearby<span style="color:#A0D6B4;">s</span></b> ⓒ 2025 <br>
    All rights reserved
  </div>
</footer>

</body>
</html>
