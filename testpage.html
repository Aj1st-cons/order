<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Orders Made Easy with Order App</title>
<!-- xxxxxxxxxxxxxxxxxxxxxx -->
<style>
    .select-store {
        display:flex; 
        gap: 20px; 
        position:fixed; 
        overflow-y:hidden; 
        top: -3%;         
        left:15%; 
        width: 100%
        height: 50px;
        padding: 10px;
        justify-content:center;    
        margin-top:100px; 
        z-index:15;
    }
    .cardx2 { 
        margin-top: 0px;                          
        box-shadow: 0 0 10px rgba(0, 0, 0, 1);
        border-radius: 10px;
        text-align: center;   
        height: 20px:         
    }
    .cardx2 p {
        margin: 10px;
        margin-top:7px;
        padding: 5px;
    }
    .item-card2 {
            margin-top: 0px;              
            background: linear-gradient(to top right, #eeeeee, #fff);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            text-align: center;
            padding: 5px;            
            cursor: pointer;
            width: 100px;
            height: 115px;
            transition: transform 0.2s;
        }
        .item-card2:hover {
            transform: scale(1.05);
        }
        .item-card2 img {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 8px;
        }
        .item-card2 p {
            margin-top: -3px;
            line-height: 0.8;
            color: #52595d;
            font-size: 13px;
            white-space: nowrap;
            font-weight: bold;
        }  
</style>
<link rel="stylesheet" href="https://order-1ib.pages.dev/index.css">     
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"> 
<link href="https://fonts.googleapis.com/css2?family=Lilita+One&amp;display=swap" rel="stylesheet">       
</head>
    <body onload="getUserLocation()">

        <div class="header">
    <a href="https://order-app-ae.myshopify.com/pages/main-page" style="margin-right: 10px;">
        <h1 style="margin: 0;">Order App</h1>
    </a>    
    <div class="replaceable-text" onclick="showLocationPopup()" style="margin-right: 10px; margin-top:5px; cursor: pointer;">
    Change Location
   </div>
   <div class="icon-container" onclick="showLocationPopup()" style="cursor: pointer; margin-top:5px;">
    <i class="fa-solid fa-rotate" style="color: #009500;"></i>
   </div>
       </div>       
          <!-- Welcome Screen -->
<div id="welcome" class="visible">    
        <h1>
            <span>O</span><span>r</span><span>d</span><span>e</span><span>r</span>
            <span class="space"></span>
            <span>A</span><span>p</span><span>p</span>
        </h1>
      <!--  <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/welcome_image.png?v=1737684481" alt="Welcome Image"> -->
    </div> 
<!-- xxxxxxxxxxxxxxxxxxxx -->   
<div class="select-store">

<div class="cardx2" onclick="closePopup()">        
    <p>select items</p>
    </div>
    
<div class="cardx2" style="background:#009500;" onclick="fetchStores()">
    <p style="color:white;">Stores Near You</p>
</div>

</div>
<!-- xxxxxxxxxxxxxxxxxxxx -->             
                  <!--  -->
       <div id="categories" class="item-grid" style="margin-top: 150px; margin-bottom: 50px;">
<!-- xxxxxxxxxxxxxxxxxxxx -->                                                     
<div class="cardx" onclick="showItems('vegetables')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072235.webp?v=1738386080" alt="Vegetables">
        <p>Vegetables</p>
    </div>
    
<div class="cardx" onclick="showItems('fruits')">
       <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072237.webp?v=1738385978" alt="Fruits">
       <p>Fruits</p>
    </div>
    
<div class="cardx" onclick="showItems('meat')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072170.webp?v=1738385944" alt="Meat">
        <p>Meat & Chicken</p>
    </div>

<div class="cardx" onclick="showItems('cafeteria')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072168.webp?v=1738385898" alt="Cafeteria">
        <p>Cafeteria</p>
    </div>

<div class="cardx" onclick="showItems('restaurants')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072167.webp?v=1738386042" alt="Restaurants">
        <p>Restaurants</p>
    </div>

<div class="cardx" onclick="showItems('bakery')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072169.webp?v=1738385927" alt="Bakery">
        <p>Bakery & Spreads</p>
    </div>

<div class="cardx" onclick="showItems('oils')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072175.webp?v=1738385868" alt="Oils">
        <p>Oils & Season</p>
    </div>

<div class="cardx" onclick="showItems('seafood')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072243.webp?v=1738385970" alt="Seafood">
        <p>Seafood</p>
    </div>

<div class="cardx" onclick="showItems('spices')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072183.webp?v=1738386023" alt="Spices">
        <p>Spices</p>
    </div>

<div class="cardx" onclick="showItems('beverages')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072229.webp?v=1738385955" alt="Beverages">
        <p>Beverages</p>
    </div>

<div class="cardx" onclick="showItems('beauty')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072220.webp?v=1738385848" alt="Beauty">
        <p>Beauty</p>
    </div>

<div class="cardx" onclick="showItems('eggs')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072226.webp?v=1738385841" alt="Eggs">
        <p>Eggs & Dairy</p>
    </div>

<div class="cardx" onclick="showItems('ready to cook')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072181.webp?v=1738386054" alt="Ready to cook">
        <p>Ready to cook</p>
    </div>

<div class="cardx" onclick="showItems('snacks')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072182.webp?v=1738385890" alt="Snacks">
        <p>Snacks & Sweets</p>
    </div>

<div class="cardx" onclick="showItems('rice & grains')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072172.webp?v=1738385935" alt="Rice & Grains">
        <p>Rice & Grains</p>
    </div>

<div class="cardx" onclick="showItems('delicatessen')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072171.webp?v=1738386062" alt="Delicatessen">
        <p>Delicatessen</p>
    </div>

<div class="cardx" onclick="showItems('nuts')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072255.webp?v=1738386004" alt="Nuts">
        <p>Nuts</p>
    </div>

<div class="cardx" onclick="showItems('frozen')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072174.webp?v=1738386033" alt="Frozen">
        <p>Frozen & Can</p>
    </div>

<div class="cardx" onclick="showItems('tea')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072177.webp?v=1738385962" alt="Tea & coffee">
        <p>Tea & coffee</p>
    </div>

<div class="cardx" onclick="showItems('babies')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072254.webp?v=1738385879" alt="Babies">
        <p>Babies</p>
    </div>

<div class="cardx" onclick="showItems('personal')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000072250.webp?v=1738385859" alt="Personal care">
        <p>Personal care</p>
</div>           
           
<div class="cardx" onclick="showItems('home')">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000075595.webp?v=1739037778" alt="Home">
        <p>Home</p>
</div>                                                                                                                                                  <!-- xxxxxxxxxxxxxxxxxxxxxx -->           
       </div> 
                  <!--  -->    
    <div id="itemPopup" class="popup">        
 <div id="itemList" style="margin-top:100px;"></div></div>                              
                   <!--  -->
<div id="locationPopup" class="popup2">  
    <div class="popup-footer">
        <span></span>
        <button onclick="closePopup()">
            <i class="fas fa-times"></i>
        </button>
    </div>      
    <div id="locationsList" class="popup-content"></div></div>
                   <!--  -->
<div id="cityPopup" class="popup2">  
    <div class="popup-footer">
        <button class="back-btn" onclick="goBackToLocations()">
       <i class="fas fa-arrow-left"></i> 
        </button>
        <button onclick="closePopup()">
       <i class="fas fa-times"></i>
        </button>
    </div>     
    <div id="cityList" class="popup-content"></div></div>
                   <!--  -->    
    <div id="errorPopup" class="popup2">
        <h3>Item Not Available</h3>
        <p>The selected item is not available nearby.</p>
        <br><br>
   <button onclick="closeErrorPopup()">OK</button>
    </div>   
                   <!--  -->
    <div id="locationErrorPopup" class="popup2">
        <br>
        <h3>Error</h3>
        <p>Unable to get your current location. Please turn <b>ON</b> the location</p>
        <br><br>
    <button onclick="closePopup()">OK</button>
    </div>
                   <!--  -->
   <div id="locationPromptPopup" class="bottom-popup">
        <p>Please turn on your location services for a better experience.</p></div>
                   <!--  -->
     <div id="selectLocationPopup" class="bottom-popup" style="display: none;">
    <p>Please turn your location <b>ON</b><br><br>OR<br><br>if <b>ON</b> REFRESH the page</p>
</div>                   
           <!-- Edit Popup -->
<div id="editPopup">
    <h3>Change Saved Location?</h3>
    <div class="input-container">
        <input type="text" id="editNameInput" placeholder="Enter new name" maxlength="14">
    </div>
    <div class="popup-buttons">
        <button id="editNoButton" onclick="handleEditNo()">No</button>
        <button id="editYesButton" onclick="handleEditYes()">Yes</button>
    </div>
</div>
          <!-- customNamePopup  -->
<div id="saveLocationPopup">
    <h3>Your Favourite Location</h3>
    <div class="input-container">
        <input type="text" id="saveLocationInput" placeholder="Home / Office" maxlength="14">
    </div>
    <div class="popup-buttons">
        <button id="cancelButton" onclick="closeSaveLocationPopup()">Cancel</button>
        <button id="saveLocationConfirm">Save</button>
    </div>
</div>    
         <!-- Loading Overlay -->

<!-- ///////////////////////// -->
<script src="https://order-1ib.pages.dev/welcome.js">    
</script>
<script src="https://order-1ib.pages.dev/categories.js"></script>
<script src="https://order-1ib.pages.dev/coordinates.js"></script>
<script src="https://order-1ib.pages.dev/page.js">
</script>
<script src="https://order-1ib.pages.dev/page-js-part2.js"></script>
<script src="https://order-1ib.pages.dev/page-js-part3.js"></script>
<script>
    //when the back button is pressed
window.addEventListener('popstate', function (e) {
    const popup = document.getElementById("itemPopup");

    // Check if the popup is open
    if (popup.style.display === "block") {
        // Close the popup
        popup.style.display = "none";
        
        // Prevent the default behavior of going back
        history.pushState(null, null, location.href);
    }
});

// Function to open the popup and update the browser history state
function showItems(category) {
    fetch(categoryUrls[category])
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.text();
        })
        .then(data => {
            let parser = new DOMParser();
            let doc = parser.parseFromString(data, "text/html");
            let items = [];

            doc.querySelectorAll(".item-card").forEach(card => {
                let img = card.querySelector("img")?.src;
                let name = card.querySelector("p")?.textContent;
                if (img && name) items.push({ name, image: img });
            });

            let itemList = `<div class="item-grid">`;
            items.forEach(item => {
                itemList += `
                    <div class="item-card" onclick="searchItem('${item.name}')">
                        <img src="${item.image}" alt="${item.name}" loading="lazy">
                        <p>${item.name}</p>
                    </div>
                `;
            });
            itemList += `</div>`;
            document.getElementById("itemList").innerHTML = itemList;
            document.getElementById("itemPopup").style.display = "block";

            // Push state to the history to avoid going back to previous page
            history.pushState(null, null, location.href);
        })
        .catch(error => {
            console.error("Error loading items:", error);
            document.getElementById("errorPopup").style.display = "block";
        });
}
</script>

<script>
function fetchStores() {
    let url = "https://order-1ib.pages.dev/Stores.html";

    fetch(url)
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.text();
        })
        .then(data => {
            let parser = new DOMParser();
            let doc = parser.parseFromString(data, "text/html");
            let items = [];

            let cards = doc.querySelectorAll(".item-card2");
            console.log("Found items:", cards.length); // Debugging

            cards.forEach(card => {
                let img = card.querySelector("img")?.src;
                let name = card.querySelector("p")?.textContent?.trim();
                if (img && name) items.push({ name, image: img });
            });

            if (items.length === 0) {
                document.getElementById("itemList").innerHTML = "<p>No items found.</p>";
            } else {
                let itemList = `<div class="item-grid">`;
                items.forEach(item => {
                    itemList += `
                        <div class="item-card2" onclick="searchItem('${item.name}')">
                            <img src="${item.image}" alt="${item.name}" loading="lazy">
                            <p>${item.name}</p>
                        </div>
                    `;
                });
                itemList += `</div>`;
                document.getElementById("itemList").innerHTML = itemList;
            }
            document.getElementById("itemPopup").style.display = "block";
        })
        .catch(error => {
            console.error("Error loading items:", error);
            document.getElementById("errorPopup").style.display = "block";
        });
}
</script>
<!--  --><!--  --><!--  --><!--  -->
<script>
    function handleClick(event) {
    let category = event.currentTarget.querySelector("p").innerText.trim();
    searchVendorsByCategory(category);
}

function searchVendorsByCategory(category) {
    let userLocation = getSavedLocation();

    if (!userLocation) {
        const locationPopup = document.getElementById("selectLocationPopup");
        locationPopup.style.display = "block";
        setTimeout(() => {
            locationPopup.style.display = "none";
        }, 4000);
        return;
    }

    let nearbyVendors = [];

    for (const vendor in vendors) {
        if (vendors[vendor].categories.includes(category)) {
            let distance = getDistance(
                userLocation.lat, userLocation.lng,
                vendors[vendor].lat, vendors[vendor].lng
            );

            if (distance <= 1) nearbyVendors.push(vendor);
        }
    }

    if (nearbyVendors.length > 0) {
        let collectionsQuery = encodeURIComponent(nearbyVendors.join(","));
        window.location.href = `https://order-app-ae.myshopify.com/pages/stores?collections=${collectionsQuery}`;
    } else {
        document.getElementById("errorPopup").style.display = "block";
    }
}

// ** Distance Calculation (Existing Logic) **
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}
</script>

<!-- ///////////////////////// -->    
         <!-- FOOTER -->
<footer class="footer">  
    <a href="https://order-app-ae.myshopify.com/cart" class="footer-btn">
        <i class="fas fa-shopping-cart"></i>
    </a>
    <button class="footer-btn home-btn">
        <img src="https://cdn.shopify.com/s/files/1/0664/3751/3414/files/1000074587.webp?v=1738560869" alt="Home" style="width: 80px; height: auto; margin-bottom: 0px; margin-left: -7px;">
    </button>            
    <a href="https://shopify.com/66437513414/account" class="footer-btn">
        <i class="fas fa-user"></i>
    </a>
</footer>
<!-- ///////////////////////// -->
